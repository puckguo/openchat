# Open CoChat - 快速参考

## 项目概述

| 项目 | 说明 |
|------|------|
| 项目名称 | OpenCode 多人协作 AI 聊天室 |
| 基于项目 | [OpenCode](https://opencode.ai) - 开源 AI 编程助手 |
| 开源协议 | MIT License |
| 技术栈 | TypeScript + Bun + WebSocket + PostgreSQL + OSS |
| 部署方式 | 云服务器 / 本地 / Docker |

---

## 核心卖点（3句话）

1. **多人实时聊天** - 支持团队协作，像 Discord 一样自然
2. **AI 智能助手** - @ai 触发，能读写代码、执行命令
3. **开源私有部署** - 数据完全自主可控

---

## 功能清单

### 对话功能
- 实时聊天 / 消息广播
- @ 提及（@ai / @all / @用户）
- 消息编辑 / 删除
- 表情回复
- 输入状态提示

### AI 能力
- DeepSeek 智能对话
- 读取项目文件
- 写入/编辑文件
- 搜索文件内容
- 执行终端命令
- 对话自动总结
- 上下文记忆管理

### 文件功能
- 文件上传（OSS 云存储）
- 文件共享下载
- 图片预览
- 代码高亮
- AI 文件操作

### 权限功能
- 5种角色（Owner/Admin/Member/Guest/AI）
- 30+ 细粒度权限
- 会话密码保护
- 用户踢出/邀请

### 数据功能
- PostgreSQL 消息持久化
- 阿里云 OSS 文件存储
- 聊天记录自动保存
- AI 对话历史管理

---

## 技术架构图

```
┌─────────────────────────────────────────────┐
│                   客户端                     │
│         Web 浏览器 / WebSocket               │
└──────────────────┬──────────────────────────┘
                   │
┌──────────────────▼──────────────────────────┐
│         WebSocket 服务器 (Bun)               │
│  ┌─────────────────────────────────────┐   │
│  │  连接管理 | 消息路由 | 权限验证      │   │
│  └─────────────────────────────────────┘   │
│  ┌─────────────────────────────────────┐   │
│  │  AI Agent (DeepSeek + 工具调用)      │   │
│  │  - 文件工具 - 终端工具 - 搜索工具   │   │
│  └─────────────────────────────────────┘   │
└────┬────────────┬────────────┬──────────────┘
     │            │            │
┌────▼─────┐  ┌──▼──────┐  ┌──▼────────┐
│PostgreSQL│  │阿里云OSS │  │DeepSeek AI│
│ 消息存储  │  │ 文件存储 │  │  API调用  │
└──────────┘  └─────────┘  └───────────┘
```

---

## 快速部署

### 方式1：直接运行
```bash
git clone <repo>
cd opencode-chat-deploy
bun install
bun run start
```

### 方式2：Docker
```bash
docker build -t opencode-chat .
docker run -p 3002:3002 -e DEEPSEEK_API_KEY=xxx opencode-chat
```

### 方式3：云服务器
```bash
# 购买云服务器（2核4G）
# 安装 Bun
curl -fsSL https://bun.sh/install | bash

# 克隆项目并启动
git clone <repo>
cd opencode-chat-deploy
bun install && bun run start
```

---

## 环境配置

```env
# WebSocket 服务器
WS_PORT=3002

# PostgreSQL（可选，用于持久化）
VITE_RDS_HOST=your-rds-host
VITE_RDS_DATABASE=opencode-chat
VITE_RDS_USER=your-user
VITE_RDS_PASSWORD=your-password
ENABLE_DATABASE=true

# 阿里云 OSS（可选，用于文件存储）
VITE_OSS_ACCESS_KEY_ID=your-key
VITE_OSS_BUCKET=your-bucket
VITE_OSS_REGION=oss-cn-beijing
ENABLE_OSS=true

# DeepSeek AI
DEEPSEEK_API_KEY=sk-your-key
DEEPSEEK_BASE_URL=https://api.deepseek.com/v1
DEEPSEEK_MODEL=deepseek-chat
ENABLE_AI=true
```

---

## 使用示例

### 场景1：AI 帮忙调试

```
你: @ai src/api.ts 第42行报错了，帮我看看

AI: [正在思考...]
    [正在使用工具 read_file...]

    我已读取 src/api.ts，问题在于：

    第42行 getUserById() 返回了 User | null 类型，
    但调用处没有处理空值情况。

    建议修复：
    ```typescript
    const user = await getUserById(id);
    if (!user) {
      throw new Error('User not found');
    }
    ```

    需要我帮你修改文件吗？
```

### 场景2：团队协作

```
张三: @all 今天下午3点开会讨论新功能
李四: 收到
王五: 好的
AI: [已自动记录到待办事项]
```

### 场景3：代码搜索

```
你: @ai 帮我找一下项目中所有用到 useState 的地方

AI: [正在使用工具 search_files...]

    找到 15 个匹配结果：

    1. src/components/UserList.tsx:12
    2. src/hooks/useAuth.ts:8
    3. src/pages/Dashboard.tsx:23
    ...

    需要详细查看某个文件吗？
```

---

## 项目结构

```
opencode-chat-deploy/
├── multiplayer/              # 核心服务器
│   ├── websocket-server.ts   # WebSocket 主服务
│   ├── ai-service.ts         # DeepSeek AI 集成
│   ├── ai-agent.ts           # AI Agent (工具调用)
│   ├── database.ts           # PostgreSQL 操作
│   ├── oss.ts                # 阿里云 OSS 操作
│   ├── role.ts               # 角色权限系统
│   └── tools/                # AI 工具集
├── public/                   # 前端页面
├── marketing/                # 推广素材
├── package.json              # 依赖配置
├── README.md                 # 项目文档
└── .env                      # 环境配置
```

---

## 版本历史

| 版本 | 日期 | 主要更新 |
|------|------|----------|
| v1.0 | 2024.02 | 初始版本发布 |
| - | - | - |

---

## 常见问题

**Q: 支持多少用户？**
A: 单会话建议不超过 50 人，可部署多个实例。

**Q: AI 支持哪些模型？**
A: 目前支持 DeepSeek，可扩展到 OpenAI/Claude/本地模型。

**Q: 数据安全吗？**
A: 开源私有部署，所有数据在你自己的服务器上。

**Q: 部署需要什么配置？**
A: 最低 1核2G，推荐 2核4G 云服务器。

---

## 联系方式

- GitHub: [your-repo]
- Email: [your-email]
- 微信群: [qrcode]
- Discord: [invite-link]

---

*让 AI 成为你的团队协作伙伴*
